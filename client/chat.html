<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chatify</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- Dependencies -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.9/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Outfit', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'] 
                    },
                    colors: {
                        // Soft modern palette
                        bg: { light: '#F2F4F7', dark: '#09090B' },
                        surface: { light: '#FFFFFF', dark: '#18181B' },
                        primary: { light: '#18181B', dark: '#FAFAFA' },
                        accent: '#3B82F6'
                    },
                    boxShadow: {
                        'soft': '0 20px 40px -10px rgba(0,0,0,0.05)',
                        'glow': '0 0 20px rgba(59, 130, 246, 0.15)'
                    }
                }
            }
        }
    </script>
    
    <style>
        /* Modern Reset & Utilities */
        body { background-color: #F2F4F7; color: #18181B; transition: background-color 0.5s ease; }
        .dark body { background-color: #09090B; color: #FAFAFA; }
        
        .scroller::-webkit-scrollbar { width: 0px; } /* Clean look */
        .scroller:hover::-webkit-scrollbar { width: 4px; }
        .scroller::-webkit-scrollbar-thumb { background: #CBD5E1; border-radius: 10px; }
        .dark .scroller::-webkit-scrollbar-thumb { background: #3F3F46; }

        /* Floating Layout */
        .app-grid {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            gap: 1.5rem;
            padding: 1.5rem;
            height: 100vh;
            max-width: 1920px;
            margin: 0 auto;
        }

        @media (max-width: 1536px) { .app-grid { grid-template-columns: 260px 1fr 0px; gap: 1rem; padding: 1rem; } }
        @media (max-width: 1024px) { .app-grid { grid-template-columns: 80px 1fr 0px; } }
        @media (max-width: 768px) { .app-grid { grid-template-columns: 0px 1fr 0px; padding: 0; gap: 0; } }

        .card-surface {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 24px;
        }
        .dark .card-surface {
            background: rgba(24, 24, 27, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .msg-bubble-own { 
            background: #18181B; color: white; 
            border-radius: 20px 20px 4px 20px;
        }
        .dark .msg-bubble-own { background: #FAFAFA; color: black; }

        .msg-bubble-other { 
            background: white; color: #18181B; 
            border-radius: 20px 20px 20px 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        }
        .dark .msg-bubble-other { 
            background: #27272A; color: #FAFAFA;
            box-shadow: none;
        }
    </style>
</head>
<body class="overflow-hidden transition-colors duration-500 selection:bg-black selection:text-white dark:selection:bg-white dark:selection:text-black">

    <div class="app-grid transition-all duration-500">
        
        <!-- NAV DOCK (Left) -->
        <aside class="card-surface flex flex-col h-full overflow-hidden shadow-soft relative z-20 transition-all duration-500">
            <!-- Header -->
            <div class="h-20 flex items-center px-6 shrink-0">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="window.location.href='/'">
                    <div class="w-10 h-10 bg-gradient-to-br from-gray-900 to-black dark:from-white dark:to-gray-200 rounded-xl flex items-center justify-center shadow-lg transition-transform group-hover:scale-95">
                        <i data-lucide="message-square" class="w-5 h-5 text-white dark:text-black"></i>
                    </div>
                    <span class="font-bold text-lg tracking-tight hidden lg:block group-hover:translate-x-1 transition-transform">Chatify</span>
                </div>
            </div>

            <!-- Scroll Area -->
            <div class="flex-1 overflow-y-auto scroller px-4 py-2 space-y-8">
                <!-- Main Actions -->
                <div class="space-y-1">
                    <div onclick="Chat.load('getting-started')" class="nav-btn flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-black/5 dark:hover:bg-white/5 cursor-pointer transition-all active:scale-95">
                        <i data-lucide="layout-grid" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
                        <span class="text-sm font-medium hidden lg:block">Overview</span>
                    </div>
                    <div onclick="window.location.href='/settings.html'" class="nav-btn flex items-center gap-3 px-3 py-2.5 rounded-xl hover:bg-black/5 dark:hover:bg-white/5 cursor-pointer transition-all active:scale-95">
                        <i data-lucide="sliders-horizontal" class="w-5 h-5 text-gray-500 dark:text-gray-400"></i>
                        <span class="text-sm font-medium hidden lg:block">Settings</span>
                    </div>
                </div>

                <!-- Channels -->
                <div>
                    <div class="flex items-center justify-between px-2 mb-2 lg:mb-3">
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider hidden lg:block">Channels</span>
                        <i data-lucide="hash" class="w-4 h-4 text-gray-400 lg:hidden mx-auto"></i>
                        <button class="hidden lg:block p-1 hover:bg-black/5 dark:hover:bg-white/5 rounded-lg transition-colors">
                            <i data-lucide="plus" class="w-3.5 h-3.5 text-gray-500"></i>
                        </button>
                    </div>
                    <div id="channel-list" class="space-y-1"></div>
                </div>

                <!-- People -->
                <div>
                    <div class="flex items-center justify-between px-2 mb-2 lg:mb-3">
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider hidden lg:block">Messages</span>
                        <i data-lucide="users" class="w-4 h-4 text-gray-400 lg:hidden mx-auto"></i>
                        <span class="hidden lg:block text-xs font-bold text-emerald-500 bg-emerald-500/10 px-2 py-0.5 rounded-full" id="online-count">0</span>
                    </div>
                    <div id="user-list" class="space-y-1"></div>
                </div>
            </div>

            <!-- User Mini Profile -->
            <div class="p-4 mt-auto">
                <div class="flex items-center gap-3 p-2 rounded-xl bg-black/5 dark:bg-white/5 border border-black/5 dark:border-white/5 cursor-pointer hover:bg-black/10 dark:hover:bg-white/10 transition-colors" onclick="window.location.href='/settings.html'">
                    <img id="my-avatar" src="" class="w-9 h-9 rounded-lg object-cover bg-gray-200">
                    <div class="hidden lg:block overflow-hidden">
                        <p id="my-name" class="text-xs font-bold truncate">User</p>
                        <p class="text-[10px] text-green-500 font-medium">Online</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN STAGE (Center) -->
        <main class="flex flex-col h-full relative z-10 overflow-hidden card-surface shadow-soft transition-all duration-500">
            
            <!-- Chat Header -->
            <header class="h-20 px-6 flex items-center justify-between border-b border-black/5 dark:border-white/5 shrink-0 backdrop-blur-md z-20">
                <div class="flex items-center gap-4">
                    <button class="lg:hidden p-2 -ml-2 text-gray-500" onclick="UI.toggleSidebar()">
                        <i data-lucide="menu" class="w-6 h-6"></i>
                    </button>
                    <div class="flex flex-col">
                        <div class="flex items-center gap-2">
                            <h2 id="room-name" class="font-bold text-lg tracking-tight">Overview</h2>
                            <span class="w-1.5 h-1.5 bg-green-500 rounded-full shadow-glow"></span>
                        </div>
                        <span id="typing-indicator" class="text-xs text-gray-400 font-medium h-4 transition-all opacity-0 translate-y-1"></span>
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <button onclick="Chat.toggleSearch()" class="w-10 h-10 rounded-full hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center transition-colors text-gray-500">
                        <i data-lucide="search" class="w-5 h-5"></i>
                    </button>
                    <button onclick="App.toggleTheme()" class="w-10 h-10 rounded-full hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center transition-colors text-gray-500">
                        <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
                        <i data-lucide="moon" class="w-5 h-5 dark:hidden"></i>
                    </button>
                    <button onclick="UI.toggleContext()" class="xl:hidden w-10 h-10 rounded-full hover:bg-black/5 dark:hover:bg-white/5 flex items-center justify-center transition-colors text-gray-500">
                        <i data-lucide="panel-right" class="w-5 h-5"></i>
                    </button>
                </div>
            </header>

            <!-- Feed -->
            <div id="messages-feed" class="flex-1 overflow-y-auto scroller p-6 space-y-6">
                <!-- Messages -->
            </div>

            <!-- Input Island -->
            <div class="p-6 pt-2 shrink-0 z-20 relative">
                <!-- Reply Preview Overlay -->
                <div id="reply-preview" class="absolute bottom-24 left-6 right-6 mx-auto max-w-3xl bg-white/90 dark:bg-zinc-900/90 backdrop-blur-md border border-black/5 dark:border-white/5 rounded-2xl p-3 shadow-lg flex items-center justify-between hidden transform translate-y-4 opacity-0 transition-all duration-300">
                    <div class="flex items-center gap-3 overflow-hidden">
                        <div class="w-1 h-8 bg-accent rounded-full"></div>
                        <div>
                            <p class="text-xs font-bold text-accent">Replying to <span id="reply-target">User</span></p>
                            <p class="text-xs text-gray-500 truncate max-w-md" id="reply-content">Message...</p>
                        </div>
                    </div>
                    <button onclick="Chat.clearReply()" class="p-1 hover:bg-black/5 rounded-full"><i data-lucide="x" class="w-4 h-4"></i></button>
                </div>

                <div class="max-w-3xl mx-auto bg-white dark:bg-zinc-900 border border-black/5 dark:border-white/5 rounded-[28px] shadow-lg p-2 flex items-end gap-2 transition-shadow hover:shadow-xl focus-within:shadow-xl focus-within:ring-1 ring-black/5 dark:ring-white/10">
                    <button class="p-3 rounded-full hover:bg-black/5 dark:hover:bg-white/5 text-gray-400 transition-colors" onclick="document.getElementById('file-upload').click()">
                        <i data-lucide="paperclip" class="w-5 h-5"></i>
                    </button>
                    <input type="file" id="file-upload" class="hidden" onchange="Chat.handleUpload(this)">
                    
                    <textarea id="msg-input" rows="1" placeholder="Type a message..." class="flex-1 bg-transparent border-none outline-none py-3 text-sm max-h-32 resize-none placeholder:text-gray-400"></textarea>
                    
                    <button onclick="Chat.send()" class="p-3 bg-black dark:bg-white text-white dark:text-black rounded-full hover:scale-105 active:scale-95 transition-all shadow-md">
                        <i data-lucide="send" class="w-4 h-4 translate-x-0.5"></i>
                    </button>
                </div>
            </div>
        </main>

        <!-- INFO PANEL (Right) -->
        <aside id="context-panel" class="hidden xl:flex flex-col card-surface shadow-soft overflow-hidden h-full">
            <div class="p-6 border-b border-black/5 dark:border-white/5">
                <h3 class="font-bold text-lg">Details</h3>
            </div>
            
            <div class="flex-1 overflow-y-auto scroller p-6 space-y-8">
                <!-- Room Stats -->
                <div class="text-center py-6">
                    <div class="w-20 h-20 bg-gray-100 dark:bg-white/5 rounded-full mx-auto flex items-center justify-center mb-4">
                        <i data-lucide="hash" class="w-8 h-8 text-gray-400"></i>
                    </div>
                    <h2 id="context-room-name" class="font-bold text-xl mb-1">General</h2>
                    <p class="text-xs text-gray-500">Public Channel</p>
                </div>

                <!-- Info Cards -->
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white dark:bg-white/5 p-4 rounded-2xl border border-black/5 dark:border-white/5 text-center">
                        <p class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">Members</p>
                        <p class="text-xl font-bold mt-1" id="stat-members">0</p>
                    </div>
                    <div class="bg-white dark:bg-white/5 p-4 rounded-2xl border border-black/5 dark:border-white/5 text-center">
                        <p class="text-[10px] uppercase font-bold text-gray-400 tracking-wider">Ping</p>
                        <p class="text-xl font-bold mt-1 text-green-500" id="stat-ping">12ms</p>
                    </div>
                </div>

                <!-- Media -->
                <div>
                    <div class="flex items-center justify-between mb-3 px-1">
                        <span class="text-xs font-bold text-gray-500">Shared Media</span>
                        <span class="text-xs text-accent cursor-pointer hover:underline">View All</span>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <div class="aspect-square bg-gray-200 dark:bg-white/5 rounded-lg animate-pulse"></div>
                        <div class="aspect-square bg-gray-200 dark:bg-white/5 rounded-lg animate-pulse"></div>
                        <div class="aspect-square bg-gray-200 dark:bg-white/5 rounded-lg animate-pulse"></div>
                    </div>
                </div>

                <!-- Purge Timer -->
                <div class="mt-auto bg-red-500/5 border border-red-500/10 rounded-2xl p-5 text-center">
                    <div class="flex items-center justify-center gap-2 mb-2 text-red-500">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        <span class="text-xs font-bold uppercase tracking-wider">Auto-Purge</span>
                    </div>
                    <p class="text-2xl font-mono font-bold text-red-600 dark:text-red-400">60:00</p>
                </div>
            </div>
        </aside>

    </div>

    <!-- Modals & Overlays -->
    <div id="user-popover" class="fixed hidden z-50 bg-white/90 dark:bg-zinc-900/90 backdrop-blur-xl border border-black/5 dark:border-white/5 shadow-2xl rounded-3xl p-6 w-72 transform scale-95 opacity-0 transition-all duration-300">
        <div class="text-center">
            <img id="popover-avatar" src="" class="w-20 h-20 rounded-2xl mx-auto mb-4 shadow-lg object-cover">
            <h3 id="popover-name" class="font-bold text-lg">User</h3>
            <span class="text-xs text-green-500 font-medium bg-green-500/10 px-2 py-1 rounded-full mt-2 inline-block">Online</span>
            <div class="mt-6 flex gap-2">
                <button onclick="Chat.startDM()" class="flex-1 py-2.5 bg-black dark:bg-white text-white dark:text-black rounded-xl text-xs font-bold uppercase tracking-wider hover:opacity-90 transition-opacity">Message</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
    <script>
        // UI Helpers
        window.UI = {
            toggleSidebar: () => {
                const nav = document.getElementById('system-nav');
                // Logic for mobile sidebar toggle (simplified)
                nav.classList.toggle('hidden'); 
                nav.classList.toggle('absolute');
                nav.classList.toggle('inset-0');
                nav.classList.toggle('w-full');
            },
            toggleContext: () => {
                const panel = document.getElementById('context-panel');
                panel.classList.toggle('hidden');
                panel.classList.toggle('flex');
                panel.classList.toggle('absolute');
                panel.classList.toggle('right-0');
                panel.classList.toggle('z-50');
                panel.classList.toggle('h-full');
            }
        };
        setTimeout(() => lucide.createIcons(), 100);
    </script>
</body>
</html>