<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chatify</title>
    
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.9/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        black: '#000000',
                        white: '#ffffff',
                        gray: {
                            50: '#f9f9f9',
                            100: '#f3f3f3',
                            200: '#e5e5e5',
                            800: '#262626',
                            900: '#171717'
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body { 
            font-family: 'Inter', sans-serif;
            overflow: hidden;
        }
        
        /* Custom Scrollbar - Minimal */
        .scroller::-webkit-scrollbar { width: 4px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background: #e5e5e5; border-radius: 4px; }
        .dark .scroller::-webkit-scrollbar-thumb { background: #333; }
        .scroller::-webkit-scrollbar-thumb:hover { background: #999; }

        /* Utilities */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        .transition-layout { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body class="bg-white dark:bg-black text-black dark:text-white transition-colors duration-200">

    <div id="app-root" class="h-screen w-screen flex relative overflow-hidden">
        
        <!-- SIDEBAR (Navigation) -->
        <!-- Collapses to icons on medium screens (<1280px) to save space for chat -->
        <aside class="w-20 xl:w-72 h-full flex flex-col shrink-0 border-r border-gray-200 dark:border-gray-800 bg-white dark:bg-black z-30 transition-layout">
            
            <!-- Header -->
            <div class="h-16 flex items-center justify-center xl:justify-start xl:px-6">
                <div class="flex items-center gap-3 cursor-pointer group" onclick="window.location.href='/'">
                    <div class="w-10 h-10 bg-black dark:bg-white rounded-xl flex items-center justify-center transition-transform group-hover:scale-95">
                        <i data-lucide="message-square" class="w-5 h-5 text-white dark:text-black"></i>
                    </div>
                    <span class="hidden xl:block font-bold text-xl tracking-tight">Chatify</span>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto scroller py-6 flex flex-col gap-8">
                
                <!-- Main Nav -->
                <div class="px-3 xl:px-4 space-y-1">
                    <div onclick="Chat.load('getting-started')" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-900 cursor-pointer transition-colors group" title="Overview">
                        <i data-lucide="layout-dashboard" class="w-5 h-5 text-gray-800 dark:text-gray-200"></i>
                        <span class="hidden xl:block text-sm font-semibold">Overview</span>
                    </div>
                    <div onclick="window.location.href='/settings.html'" class="flex items-center gap-3 p-3 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-900 cursor-pointer transition-colors group" title="Settings">
                        <i data-lucide="settings-2" class="w-5 h-5 text-gray-800 dark:text-gray-200"></i>
                        <span class="hidden xl:block text-sm font-semibold">Settings</span>
                    </div>
                </div>

                <!-- Channels -->
                <div class="px-3 xl:px-4 space-y-2">
                    <div class="hidden xl:flex items-center justify-between px-2">
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Channels</span>
                        <i data-lucide="plus" class="w-4 h-4 text-black dark:text-white cursor-pointer hover:opacity-50"></i>
                    </div>
                    <!-- Icon only view for small screens handled by CSS grid/flex logic in JS or just simple stack here -->
                    <div id="channel-list" class="flex flex-col gap-1">
                        <!-- Populated via JS -->
                    </div>
                </div>

                <!-- People -->
                <div class="px-3 xl:px-4 space-y-2">
                    <div class="hidden xl:flex items-center justify-between px-2">
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-wider">Direct Messages</span>
                    </div>
                    <div id="user-list" class="flex flex-col gap-1">
                        <!-- Populated via JS -->
                    </div>
                </div>

            </div>

            <!-- Profile Footer -->
            <div class="p-4 border-t border-gray-200 dark:border-gray-800">
                <div class="flex items-center gap-3 p-2 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-900 cursor-pointer transition-colors" onclick="window.location.href='/settings.html'">
                    <img id="my-avatar" src="" class="w-9 h-9 rounded-lg bg-gray-100 object-cover border border-gray-200 dark:border-gray-800">
                    <div class="hidden xl:block flex-1 min-w-0">
                        <span id="my-name" class="block text-sm font-bold truncate">User</span>
                        <span class="block text-xs text-gray-400">Online</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CHAT (Center) -->
        <main class="flex-1 flex flex-col min-w-0 relative bg-white dark:bg-black">
            
            <!-- Header -->
            <header class="h-16 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between px-6 shrink-0">
                <div class="flex items-center gap-4">
                    <!-- Mobile Menu Trigger -->
                    <button class="xl:hidden p-2 -ml-2 text-black dark:text-white" onclick="document.getElementById('nav-sidebar').classList.toggle('hidden-mobile')"> 
                        <!-- Logic handled via CSS class toggle usually, simplified here -->
                        <i data-lucide="menu" class="w-5 h-5"></i>
                    </button>
                    
                    <div>
                        <h2 id="room-name" class="text-base font-bold text-black dark:text-white">Overview</h2>
                        <div class="flex items-center gap-2">
                            <span id="typing-indicator" class="text-xs font-medium text-gray-400 h-4 block"></span>
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <button onclick="Chat.toggleSearch()" class="p-2 hover:bg-gray-50 dark:hover:bg-gray-900 rounded-lg transition-colors">
                        <i data-lucide="search" class="w-5 h-5 text-gray-500"></i>
                    </button>
                    <button onclick="App.toggleTheme()" class="p-2 hover:bg-gray-50 dark:hover:bg-gray-900 rounded-lg transition-colors">
                        <i data-lucide="sun" class="w-5 h-5 hidden dark:block text-white"></i>
                        <i data-lucide="moon" class="w-5 h-5 dark:hidden text-black"></i>
                    </button>
                    <button onclick="UI.toggleContextPanel()" class="p-2 hover:bg-gray-50 dark:hover:bg-gray-900 rounded-lg transition-colors">
                        <i data-lucide="panel-right" class="w-5 h-5 text-gray-500"></i>
                    </button>
                </div>
            </header>

            <!-- Messages -->
            <div id="messages-feed" class="flex-1 overflow-y-auto scroller p-6 space-y-6">
                <!-- Messages Injected Here -->
            </div>

            <!-- Input -->
            <div class="p-6 pt-2">
                <div id="reply-preview" class="hidden mb-2 px-4 py-2 border-l-2 border-black dark:border-white bg-gray-50 dark:bg-gray-900 text-sm text-gray-500 flex justify-between items-center">
                    <span>Replying...</span>
                    <button onclick="Chat.clearReply()"><i data-lucide="x" class="w-4 h-4"></i></button>
                </div>
                
                <div class="flex items-end gap-2 bg-white dark:bg-black border border-gray-200 dark:border-gray-800 rounded-2xl p-2 shadow-sm focus-within:ring-1 ring-black dark:ring-white transition-all">
                    <button class="p-3 text-gray-400 hover:text-black dark:hover:text-white transition-colors" onclick="document.getElementById('file-upload').click()">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                    </button>
                    <input type="file" id="file-upload" class="hidden" onchange="Chat.handleUpload(this)">
                    
                    <textarea id="msg-input" rows="1" class="flex-1 bg-transparent border-none outline-none text-sm py-3 px-2 resize-none max-h-32 text-black dark:text-white placeholder:text-gray-400" placeholder="Type a message..."></textarea>
                    
                    <button onclick="Chat.send()" class="p-3 bg-black dark:bg-white rounded-xl text-white dark:text-black hover:opacity-90 transition-opacity">
                        <i data-lucide="arrow-up" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
        </main>

        <!-- DETAILS PANEL (Right) -->
        <!-- Hidden by default on small screens, togglable -->
        <aside id="context-panel" class="hidden w-80 h-full bg-white dark:bg-black border-l border-gray-200 dark:border-gray-800 flex-col shrink-0 z-20">
            <div class="p-6 h-full flex flex-col overflow-y-auto scroller">
                <div class="mb-8 text-center">
                    <div class="w-20 h-20 bg-gray-50 dark:bg-gray-900 rounded-full mx-auto flex items-center justify-center mb-4">
                        <i data-lucide="hash" class="w-8 h-8 text-black dark:text-white"></i>
                    </div>
                    <h3 id="context-room-name" class="font-bold text-lg">General</h3>
                    <p class="text-sm text-gray-500">Public Channel</p>
                </div>

                <div class="space-y-6">
                    <div>
                        <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Members</h4>
                        <div id="room-members" class="space-y-2">
                            <!-- JS Populated -->
                        </div>
                    </div>

                    <div>
                        <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Shared Files</h4>
                        <div class="grid grid-cols-3 gap-2">
                            <div class="aspect-square bg-gray-100 dark:bg-gray-900 rounded-lg"></div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-900 rounded-lg"></div>
                            <div class="aspect-square bg-gray-100 dark:bg-gray-900 rounded-lg"></div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-auto pt-6 text-center">
                    <p class="text-xs text-gray-400 font-mono">Auto-Purge: 60m</p>
                </div>
            </div>
        </aside>

    </div>

    <!-- User Popover -->
    <div id="user-popover" class="fixed hidden bg-white dark:bg-black border border-gray-200 dark:border-gray-800 shadow-xl rounded-xl w-64 z-50 p-4">
        <div class="flex flex-col items-center text-center">
            <img id="popover-avatar" src="" class="w-20 h-20 rounded-full bg-gray-100 mb-3 border border-gray-200">
            <h3 id="popover-name" class="font-bold text-lg">User</h3>
            <span class="text-xs text-green-500 font-medium mb-4">Online</span>
            <button onclick="Chat.startDM()" class="w-full py-2 bg-black dark:bg-white text-white dark:text-black rounded-lg text-sm font-bold hover:opacity-90">Message</button>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
    <script>
        // Simple Toggle for Context Panel
        UI.toggleContextPanel = () => {
            const panel = document.getElementById('context-panel');
            panel.classList.toggle('hidden');
            panel.classList.toggle('flex');
        };
        setTimeout(() => lucide.createIcons(), 100);
    </script>
</body>
</html>